// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id          Int      @id @default(autoincrement())
  fullName    String
  email       String   @unique
  phoneNumber String
  password    String   // Hashed password
  isDriver    Boolean  @default(false) // True if user is a driver
  isRider     Boolean  @default(false) // True if user is a rider
  photoUrl    String?  // Profile photo URL (optional, for drivers)
  city        String?  // City (optional, for drivers)
  carMake     String?  // Car make (optional, for drivers)
  carModel    String?  // Car model (optional, for drivers)
  carYear     Int?     // Car year (optional, for drivers)
  carColor    String?  // Car color (optional, for drivers)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  rides              Ride[]   // Rides created by this driver
  bookings           Booking[] // Bookings made by this rider
  driverNotifications Notification[] @relation("DriverNotifications") // Notifications received by this driver
  riderNotifications  Notification[] @relation("RiderNotifications") // Notifications received by this rider

  @@map("users")
}

model Ride {
  id              Int      @id @default(autoincrement())
  driverId        Int
  driverName      String
  driverPhone     String
  carMake         String?
  carModel        String?
  carYear         Int?
  carColor        String?
  fromAddress     String
  fromCity        String
  fromState       String
  fromZipCode     String
  fromLatitude    Float
  fromLongitude   Float
  toAddress       String
  toCity          String
  toState         String
  toZipCode       String
  toLatitude      Float
  toLongitude     Float
  departureDate   String
  departureTime   String
  availableSeats  Int
  pricePerSeat    Float
  distance        Float?
  totalEarnings   Float?   // Total earnings from completed ride (calculated when ride is completed)
  status          String   @default("scheduled") // scheduled, in-progress, completed, cancelled
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  driver          User     @relation(fields: [driverId], references: [id], onDelete: Cascade)
  bookings        Booking[]
  notifications   Notification[]

  @@map("rides")
}

model Booking {
  id                Int      @id @default(autoincrement())
  rideId            Int
  riderId           Int
  confirmationNumber String   @unique
  pickupAddress     String
  pickupCity        String?
  pickupState       String?
  pickupZipCode     String?
  pickupLatitude    Float
  pickupLongitude   Float
  numberOfSeats     Int      @default(1)
  status            String   @default("pending") // pending, confirmed, rejected, cancelled, completed
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  ride              Ride     @relation(fields: [rideId], references: [id], onDelete: Cascade)
  rider             User     @relation(fields: [riderId], references: [id], onDelete: Cascade)
  notifications     Notification[]

  @@map("bookings")
}

model Notification {
  id          Int      @id @default(autoincrement())
  driverId    Int?     // Driver who receives the notification (optional)
  riderId     Int?     // Rider who receives the notification (optional)
  type        String   // 'booking', 'cancellation', 'message', 'ride-started', 'ride-completed', etc.
  title       String
  message     String
  bookingId   Int?     // Optional: reference to booking if notification is about a booking
  rideId      Int?     // Optional: reference to ride if notification is about a ride
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  driver      User?    @relation("DriverNotifications", fields: [driverId], references: [id], onDelete: Cascade)
  rider       User?    @relation("RiderNotifications", fields: [riderId], references: [id], onDelete: Cascade)
  booking     Booking? @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  ride        Ride?    @relation(fields: [rideId], references: [id], onDelete: Cascade)

  @@map("notifications")
}
